<body bgcolor=black>
<center><canvas id=canvas width=800 height=800></canvas>
<script src=webgl.js></script>
<script>

/*********************************************

HOW TO RAY TRACE TO A SPHERE:

Given a ray (V•W):

        (x,y,z) = V + t * W

and a sphere (Cx,Cy,Cz,R):

        (x - Cx)² + (y - Cy)² + (z - Cz)² = R²

find the intersection of the ray and sphere.

(1) Cool trick: Move ray origin to sphere center:

        V -= C

    That makes the sphere equation simpler:

        x² + y² + z² = R²

(2) Substitute ray equation into sphere equation:

        (Vx + t*Wx)² +          
                                       
        (Vy + t*Wy)² +          
                                       
        (Vz + t*Wz)² = R²       

(3) Separate the square, linear & constant terms:

        (Wx*Wx + Wy*Wy + Wz*Wz) * t² + 

    2 * (Vx*Wx + Vy*Wy + Vz*Wz) * t +

         Vx*Vx + Vy*Vy + Vz*Vz  =     R²

(4) This is more compact in dot product notation:

        (W•W)*t² + 2*(V•W)*t + V•V = R²

(5) Now we have a quadratic equation in t:

        A t² + B t + C = 0

    where:

        A = W•W
        B = 2*(V•W)
        C = V•V - R²

(6) Solve for t, using the quadratic equation:

        t = (-B ± sqrt(B² - 4*A*C)) / (2*A)

We can simplify this:

    We've already set the length of W to 1,
    so we know W•W = 1. Therefore we can use
    a special case of the quadratic equation:

        t = -B/2 ± sqrt((B/2)² - C)

*********************************************/

function Scene() {

this.vertexShaderUrl = 'shaders/fullscreen.vert';
this.fragmentShaderUrl = 'shaders/scene1.frag';

let startTime = Date.now()/1000;

this.update = viewPoint => {
   let time = Date.now() / 1000 - startTime;
   setUniform('1f', 'uTime', time);
   setUniform('3fv', 'uViewPoint', viewPoint);
}

}

gl_start(canvas, new Scene());
</script>
