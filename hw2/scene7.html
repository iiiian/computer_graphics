<body bgcolor=black>
<center><canvas id=canvas width=800 height=800></canvas>
<script src=webgl.js></script>
<script>

/********************************************

You can shoot a ray from the surface to each
light to see whether the surface point is in
shadow from that light source.

You can also use the surface normal to add
3D procedural textures to your spheres.

*********************************************/

function Scene() {

let NS = 3;
let NL = 3;

this.vertexShaderUrl = 'shaders/fullscreen.vert';
this.fragmentShaderUrl = 'shaders/scene7.frag';
this.fragmentShaderReplacements = { NS, NL };

let startTime = Date.now()/1000;

let normalize = v => {
   let s = Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);
   return [ v[0]/s, v[1]/s, v[2]/s ];
}

this.update = viewPoint => {
   let time = Date.now()/1000 - startTime;
   setUniform('1f', 'uTime', time);
   setUniform('3fv', 'uViewPoint', viewPoint);

   let s = Math.sin(time);
   let c = Math.cos(time);

   setUniform('4fv', 'uS', [ -.3*s,0,0,.4,
                              .3*s,0,.3,.4,
                              .7*c,.7*s,0,.2 ]);

   setUniform('3fv', 'uC', [ 1,.5,.5,
                             .5,.7,1,
                             .5,1,.5 ]);

   setUniform('3fv', 'uL', [ normalize([1,1,1]),
                             normalize([-1,-1,-.5]),
                             normalize([0,-1,0])
			   ].flat());

   setUniform('3fv', 'uLC', [ .5,.7,1,
                              .2,.15,.1,
			      .5,0,0 ]);
}

}
gl_start(canvas, new Scene());
</script>
