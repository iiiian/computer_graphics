<body bgcolor=black>
<center><canvas id=canvas width=800 height=800></canvas>
<script src=webgl.js></script>
<script>

/********************************************

Because the fragment shader is just a text
string, you can modify that text string in
Javascript before compiling it.

For example, even though the loop through
objects in the shader needs to be a fixed
number of iterations, you can set that number
of iterations from Javascript by modifying
the shader source code.

*********************************************/

function Scene() {

let NS = 2;

this.vertexShaderUrl = 'shaders/fullscreen.vert';
this.fragmentShaderUrl = 'shaders/scene5.frag';
this.fragmentShaderReplacements = { NS };

let startTime = Date.now()/1000;

let normalize = v => {
   let s = Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]);
   return [ v[0]/s, v[1]/s, v[2]/s ];
}

this.update = viewPoint => {
   let time = Date.now()/1000 - startTime;
   setUniform('1f', 'uTime', time);
   setUniform('3fv', 'uViewPoint', viewPoint);

   let s = Math.sin(time);

   setUniform('4fv', 'uS', [ -.3*s,0,0,.4,
                              .3*s,0,.3,.4,
                              0,.7,.4,.2 ]);

   setUniform('3fv', 'uC', [ 1,.5,.5,
                             .5,.7,1,
                             .5,1,.5 ]);
}

}
gl_start(canvas, new Scene());
</script>
